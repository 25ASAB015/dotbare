#!/bin/bash
#
# Main entry script for dotbare, used to route command to appropriate scripts
#
# @params
# Globals
#   ${mydir}: string, directory of the executing script, used for sourcing helpers
#		${action_command}: string, determine which script to call
# Arguments
#		command: command to run general git command/fadd/frm/fpop etc
#   $opt: options flag -h -p etc

mydir="${0%/*}"
source "${mydir}"/helper/set_variable

function usage() {
  echo "help"
}

# if no argument passed in, let git display help message
if [[ -z "$@" ]]; then
  /usr/bin/git --git-dir="${DOTBARE_DIR}" --work-tree="${DOTBARE_TREE}"
  exit 0
fi

action_command=''
case "$1" in
  fadd)
    action_command='fadd'
    shift
    ;;
  frm)
    action_command='frm'
    shift
    ;;
  fpop)
    action_command='fpop'
    shift
    ;;
  freset)
    action_command='freset'
    shift
    ;;
  fcheckout)
    action_command='fcheckout'
    shift
    ;;
  help)
    usage
    exit 0
    ;;
  -h)
    usage
    exit 0
    ;;
esac

if [[ -z "${action_command}" ]]; then
  /usr/bin/git --git-dir="${DOTBARE_DIR}" --work-tree="${DOTBARE_TREE}" "$@"
else
  # run the scripts
  "${mydir}/scripts/${action_command}" "$@"
fi
